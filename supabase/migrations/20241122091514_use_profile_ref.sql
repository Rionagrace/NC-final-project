-- ALTER
ALTER TABLE markers
  DROP CONSTRAINT markers_user_id_fkey;

ALTER TABLE markers
  ADD CONSTRAINT markers_user_id_fkey FOREIGN KEY(user_id) REFERENCES profiles (user_id) ON DELETE SET NULL;

ALTER TABLE planners
  DROP CONSTRAINT planners_user_id_fkey;
ALTER TABLE planners
  ADD CONSTRAINT planners_user_id_fkey FOREIGN KEY(user_id) REFERENCES profiles (user_id) ON DELETE CASCADE;

ALTER TABLE votes
  DROP CONSTRAINT votes_user_id_fkey;
ALTER TABLE votes
  ADD CONSTRAINT votes_user_id_fkey FOREIGN KEY(user_id) REFERENCES profiles (user_id) ON DELETE CASCADE;

-- TEST
DELETE FROM auth.users WHERE id = '00000000-0000-0000-0000-000000000000';

INSERT INTO auth.users (id, email)
  VALUES ('00000000-0000-0000-0000-000000000000', 'mock@test.com');
INSERT INTO markers (title, location, user_id)
  VALUES  ('MOCK TEST', gis.st_point(-2.2368268, 53.4664686),  '00000000-0000-0000-0000-000000000000');
INSERT INTO planners (title, user_id)
  VALUES  ('MOCK TEST',  '00000000-0000-0000-0000-000000000000');
INSERT INTO votes (marker_id, user_id, value)
  VALUES  ((SELECT marker_id FROM markers WHERE user_id = '00000000-0000-0000-0000-000000000000'),  '00000000-0000-0000-0000-000000000000', 5);

DELETE FROM auth.users
  WHERE id = '00000000-0000-0000-0000-000000000000';
DELETE FROM markers
  WHERE user_id = '00000000-0000-0000-0000-000000000000';
DELETE FROM planners
  WHERE user_id = '00000000-0000-0000-0000-000000000000';
DELETE FROM votes
  WHERE user_id = '00000000-0000-0000-0000-000000000000';
